# Story 0.1: Containerize Applications

## Status
Done

## Story
**As an** operations team,
**I want** to package the `ManagementService (FastAPI)` and `MonitorUI (Next.js)` applications into Docker images,
**so that** they can be deployed consistently across all environments.

## Acceptance Criteria
1. The project contains a valid `Dockerfile` for the FastAPI application.
2. The project contains a valid `Dockerfile` for the Next.js application.
3. Both images can be successfully built and run locally.

## Tasks / Subtasks
- [x] Task 1: Create Dockerfile for ManagementService (FastAPI) (AC: 1, 3)
  - [x] Create Dockerfile in `/apps/monitor-api/` directory
  - [x] Configure Python 3.13+ base image
  - [x] Install FastAPI and all Python dependencies
  - [x] Configure proper WORKDIR and expose port
  - [x] Set up async-compatible production server (e.g., uvicorn)
  - [x] Ensure proper handling of Python package dependencies from monorepo
- [x] Task 2: Create Dockerfile for MonitorUI (Next.js) (AC: 2, 3)
  - [x] Create Dockerfile in `/apps/monitor-ui/` directory
  - [x] Configure Node.js base image with appropriate version
  - [x] Handle TypeScript compilation and Next.js build process
  - [x] Install dependencies including Shadcn/ui, Tailwind CSS, and Zustand
  - [x] Configure production build and runtime
  - [x] Ensure proper handling of shared packages from monorepo
- [x] Task 3: Test Docker builds and runtime (AC: 3)
  - [x] Build both Docker images locally
  - [x] Verify images can run without errors
  - [x] Test basic connectivity between services
  - [x] Document build commands and runtime requirements
- [x] Task 4: Create supporting Docker documentation
  - [x] Document build commands for both images
  - [x] Document environment variables and configuration requirements
  - [x] Create docker-compose.yaml for local development/testing

## Dev Notes

### Project Structure
The AegisTrader project follows a monorepo structure managed by Turborepo:
- ManagementService (FastAPI) location: `/apps/monitor-api/` [Source: architecture/source-tree.md#FastAPI Management Backend]
- MonitorUI (Next.js) location: `/apps/monitor-ui/` [Source: architecture/source-tree.md#Next.js Monitoring Frontend]
- Shared contracts package: `/packages/shared-contracts/` [Source: architecture/coding-standards.md#Contract-First]

### Technology Stack Requirements

**FastAPI Application (ManagementService):**
- Python 3.13+ required [Source: architecture/tech-stack.md#Backend Language]
- FastAPI (latest version) framework [Source: architecture/tech-stack.md#Backend Framework]
- 100% type annotation coverage mandatory [Source: architecture/coding-standards.md#Type Checking]
- All I/O operations must use async/await syntax [Source: architecture/coding-standards.md#Async Programming]
- Pydantic v2 for data entities [Source: architecture/coding-standards.md#Entity Specification]

**Next.js Application (MonitorUI):**
- TypeScript (latest version) [Source: architecture/tech-stack.md#Frontend Language]
- Next.js (latest version) framework [Source: architecture/tech-stack.md#Frontend Framework]
- Shadcn/ui components with Tailwind CSS [Source: architecture/tech-stack.md#UI Components, CSS Utility]
- Zustand for state management [Source: architecture/tech-stack.md#Frontend State]

### Containerization Standards
- Docker (latest version) as containerization technology [Source: architecture/tech-stack.md#Containerization]
- Every application must be packaged into a standalone container image [Source: architecture/infrastructure-deployment.md#Containerization]
- Images will be deployed to Kubernetes using Helm Charts [Source: architecture/tech-stack.md#Orchestration]

### Core Dependencies
- NATS & JetStream (2.9+) as core messaging platform [Source: architecture/tech-stack.md#Core Messaging]
- Applications need to connect to NATS for service registry functionality
- All core data models must be imported from `packages/shared-contracts` [Source: architecture/coding-standards.md#Contract-First]

### Previous Story Insights
No previous stories exist - this is the first story of the project.

### Testing

**Testing Standards from Architecture:**
- Test framework: Pytest (>=7.0.0) for Python backend [Source: architecture/tech-stack.md#Backend Testing]
- Test-Driven Development (TDD) is mandatory [Source: architecture/testing-strategy.md#Methodology]
- Minimum 80% overall test coverage, 100% for critical paths [Source: architecture/testing-strategy.md#Coverage]
- Testcontainers must be used for integration testing [Source: architecture/testing-strategy.md#Integration Testing]
- Test file location: Tests should be co-located with source files or in `tests/` directories
- Test naming convention: `test_{functionality}_{expected_behavior}` [Source: architecture/testing-strategy.md#Naming]

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-08-01 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
Claude Opus 4 (claude-opus-4-20250514)

### Debug Log References
- [Docker npm proxy issue resolved](.ai/debug-log.md)

### Completion Notes List
- Successfully created Dockerfiles for both FastAPI and Next.js applications
- Resolved npm install timeout issue by using Docker build arguments for proxy
- Both images build and run successfully with non-default ports (8100, 3100)
- Created docker-compose.yaml for orchestration
- Added comprehensive Docker documentation

### File List
- Created: /apps/monitor-api/Dockerfile
- Created: /apps/monitor-api/app/__init__.py
- Created: /apps/monitor-api/app/main.py
- Created: /apps/monitor-ui/Dockerfile
- Created: /apps/monitor-ui/package.json
- Created: /apps/monitor-ui/tsconfig.json
- Created: /apps/monitor-ui/next.config.js
- Created: /apps/monitor-ui/app/layout.tsx
- Created: /apps/monitor-ui/app/page.tsx
- Created: /apps/monitor-ui/.gitignore
- Created: /docker-compose.yaml
- Created: /docker/README.md
- Created: /.ai/debug-log.md

## QA Results
_To be populated by QA agent_
