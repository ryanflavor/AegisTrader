# Environment Variables Configuration

This document describes all environment variables used in the AegisTrader project.

## Core Service Configuration

### Service Ports
- `API_PORT` - FastAPI service port (default: 8100)
- `UI_PORT` - Next.js UI service port (default: 3100)
- `NATS_CLIENT_PORT` - NATS client connection port (default: 4222)
- `NATS_MONITOR_PORT` - NATS monitoring/HTTP port (default: 8222)

### Service URLs
- `NATS_URL` - Full NATS connection URL (default: nats://nats:4222)
- `NEXT_PUBLIC_API_URL` - API URL accessible from the UI (default: http://monitor-api:8100)

### Container Ports (Internal)
- `API_CONTAINER_PORT` - Internal port for API container (default: 8100)
- `UI_CONTAINER_PORT` - Internal port for UI container (default: 3100)
- `NATS_CONTAINER_PORT` - Internal port for NATS container (default: 4222)

## Application Settings

- `LOG_LEVEL` - Application log level (default: INFO)
- `ENVIRONMENT` - Deployment environment: development, staging, production (default: development)

## Build Configuration

### Docker Build
- `HTTP_PROXY` - HTTP proxy for Docker builds
- `HTTPS_PROXY` - HTTPS proxy for Docker builds
- `NO_PROXY` - Hosts to bypass proxy
- `NPM_REGISTRY` - NPM registry URL (default: https://registry.npmmirror.com)

### Repository URLs
- `NATS_HELM_REPO` - NATS Helm chart repository (default: https://nats-io.github.io/k8s/helm/charts/)

## Deployment Configuration

### Timeouts
- `DEPLOYMENT_TIMEOUT` - Deployment validation timeout in seconds (default: 300)
- `HELM_TIMEOUT` - Helm operation timeout (default: 10m)

### Default Hostnames
- `DEFAULT_NATS_HOST` - Default NATS hostname (default: localhost)
- `DEFAULT_API_HOST` - Default API hostname (default: monitor-api)
- `DEFAULT_UI_HOST` - Default UI hostname (default: monitor-ui)

### Validation Settings
- `PRODUCTION_NATS_HOST_BLACKLIST` - Comma-separated list of hosts not allowed in production NATS URLs (default: localhost,127.0.0.1)

## Usage Examples

### Local Development (.env)
```bash
# Basic configuration for local development
API_PORT=8100
UI_PORT=3100
NATS_URL=nats://nats:4222
ENVIRONMENT=development
LOG_LEVEL=DEBUG
```

### Production Deployment
```bash
# Production configuration
ENVIRONMENT=production
LOG_LEVEL=INFO
NATS_URL=nats://nats-cluster.production.svc.cluster.local:4222
PRODUCTION_NATS_HOST_BLACKLIST=localhost,127.0.0.1,nats
```

### Behind Corporate Proxy
```bash
# Proxy configuration for builds
HTTP_PROXY=http://proxy.company.com:8080
HTTPS_PROXY=http://proxy.company.com:8080
NO_PROXY=localhost,127.0.0.1,*.company.local
```

## Environment Variable Loading

### Docker Compose
Environment variables are loaded from:
1. System environment
2. `.env` file in project root
3. Default values in `docker-compose.yaml`

### Kubernetes/Helm
Environment variables are configured through:
1. Helm values files (`values.yaml`, `values.deployment.yaml`)
2. ConfigMaps generated by Helm templates
3. Environment-specific overrides (e.g., `values.dev.yaml`)

### Application Runtime
- **FastAPI (monitor-api)**: Loads from environment via `os.getenv()`
- **Next.js (monitor-ui)**: Uses `process.env` for server-side, `NEXT_PUBLIC_*` for client-side

## Best Practices

1. **Never commit sensitive values** - Use `.env` for local development only
2. **Use descriptive names** - Follow the pattern `SERVICE_PROPERTY`
3. **Provide defaults** - Always provide sensible defaults in code
4. **Document changes** - Update this file when adding new variables
5. **Validate in production** - Ensure production configs don't use development defaults
