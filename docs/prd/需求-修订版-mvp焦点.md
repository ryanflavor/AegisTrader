# **需求 (修订版 \- MVP焦点)**

## **功能性需求 (Functional Requirements)**

### **MVP 核心需求**

* **FR1**: 系统必须能接收来自CTP（期货）和SOPT（股票期权）数据源的实时Tick行情数据。  
* **FR2**: 系统必须根据核心规则对所有传入的Tick数据进行验证，包括数据完整性、时序一致性（时间戳单调递增）、价格合理性（在涨跌停范围内）以及成交量逻辑（单调递增）。  
* **FR3**: 系统必须能够识别并拒绝无效的Tick数据，并为此生成TickRejected领域事件。  
* **FR4**: 验证通过的Tick数据 (ValidatedTick) 必须被发布到NATS JetStream消息队列中，供下游服务消费。  
* **FR5**: 系统必须能够将验证后的Tick数据聚合为一分钟的OHLCV K线 (MarketBar)。  
* **FR6**: 系统必须将生成的MarketBar数据持久化存储到ClickHouse数据库中。  
* **FR7**: 系统必须管理与行情数据源的连接，包括自动认证和在连接断开时的自动重连机制。  
* **FR10**: 系统必须能够管理交易合约的订阅列表。

### **Post-MVP (第二阶段) 规划**

* **FR8**: 实现基于DataQualityMonitor聚合的实时数据流质量评分和监控。  
* **FR9**: 实现基于统计学方法（如Z-Score）的市场价格异常自动检测。

## **非功能性需求 (Non-Functional Requirements)**

### **MVP 目标**

* **NFR1 (性能-延迟)**: **目标** P99延迟小于10毫秒，架构设计应具备优化到亚毫秒级的能力。  
* **NFR2 (性能-吞吐量)**: **目标** 稳定处理每秒10,000笔Tick数据，架构设计应支持水平扩展以达到50,000+ TPS。  
* **NFR3 (可用性)**: **目标** 达到99.9%的可用性，并实现关键服务的自动故障转移。架构应支持未来达到99.95%的更高目标。

### **长期遵循**

* **NFR4 (数据一致性)**: 在单个MarketDataStream聚合的边界内，数据必须是强一致的。跨聚合操作和历史数据存储采用最终一致性。  
* **NFR5 (数据完整性)**: 一旦生成的MarketBar（K线）被存储，它就必须是不可变的。  
* **NFR6 (可伸缩性)**: 无状态的处理组件（如验证服务）必须支持水平扩展。  
* **NFR7 (可观测性)**: 系统必须提供结构化的日志和核心性能指标。

---
